 <#
 Date: 29 January 2015
 Script Author: OH

 Purpose:   Checks AD for missing staff user attributes that should have values.
            First the CSV from HR is read in and an array is built that contains
            AD users that are contained in the CSV.
            This array is then checked for the required attributes and outputs
            the results on screen. 
 #>

 $DomainDN = (Get-ADDomain).DistinguishedName
 $OU = "ou=xxx,ou=xxx"
 
 $ADStaff = Get-ADUser -SearchBase "$OU,$DomainDN" -SearchScope OneLevel -Filter * -Properties mail,employeenumber,samaccountname,department,extensionAttribute11,extensionAttribute12,extensionAttribute13,extensionAttribute14,extensionAttribute15  
   
 $CSV = Import-Csv C:\ALLStaff.csv
 
 $adusers=@()
 $MissingAttribs=@() 

Foreach ($ADPerson in $ADStaff) {
    if ( $ADPerson.department -eq $NULL -or $ADPerson.extensionAttribute11 -eq $NULL -or $ADPerson.extensionAttribute12 -eq $NULL -or $ADPerson.extensionAttribute13 -eq $NULL -or $ADPerson.extensionAttribute12 -eq $NULL -or $ADPerson.extensionAttribute15 -eq $NULL){
        $adusers+=  $adperson        
    }                                                   
}   

write-output "There are $($adusers.count) in the array that require checking.`n`n"
write-output "The following accounts have missing attributes:`n"
foreach ($User in  $adusers) {
    foreach ($CSVUser in $CSV) {
        if ($user.mail -eq $csvuser.'email address') {
            Write-Output $user.SamAccountName
            Write-Output "Department: $($user.Department)"
            Write-Output "Employment Status: $($user.extensionAttribute11)"
            Write-Output "FirstName: $($user.extensionAttribute12)"
            Write-Output "Area: $($user.extensionAttribute13)"
            Write-Output "Full Name: $($user.extensionAttribute14)"
            Write-Output "Ext: $($user.extensionAttribute15)`n`n"        
        }    
    }    
}
